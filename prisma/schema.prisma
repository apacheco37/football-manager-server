// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id         String  @id @default(uuid())
  firstName  String  @map("first_name")
  lastName   String  @map("last_name")
  age        Int
  talent     Int
  attacker   Int
  midfielder Int
  defender   Int
  goalkeeper Int
  team       Team?   @relation(fields: [teamID], references: [id])
  teamID     String?

  playerOnLineup PlayerOnLineup[]
  matchEvents    MatchEvent[]

  @@map("players")
}

model Team {
  id      String   @id @default(uuid())
  name    String   @unique
  players Player[]
  User    User?    @relation(fields: [userID], references: [id])
  userID  String?  @unique

  homeMatches Match[] @relation("HomeTeam")
  awayMatches Match[] @relation("AwayTeam")

  currentSeasonID String   @map("current_season_id")
  currentSeason   Season   @relation("CurrentSeason", fields: [currentSeasonID], references: [id])
  pastSeasons     Season[] @relation("PastSeasons")

  @@map("teams")
}

model User {
  id       String @id @default(uuid())
  email    String @unique
  username String @unique
  password String
  team     Team?

  @@map("users")
}

model Match {
  id String @id @default(uuid())

  homeTeam   Team   @relation("HomeTeam", fields: [homeTeamID], references: [id])
  homeTeamID String @map("home_team_id")
  awayTeam   Team   @relation("AwayTeam", fields: [awayTeamID], references: [id])
  awayTeamID String @map("away_team_id")

  lineupPlayers PlayerOnLineup[]

  matchResult MatchResult?

  season   Season @relation(fields: [seasonID], references: [id])
  seasonID String @map("season_id")

  @@map("matches")
}

model MatchResult {
  id Int @id @default(autoincrement())

  match   Match  @relation(fields: [matchID], references: [id])
  matchID String @unique @map("match_id")

  events MatchEvent[]

  homeRatings   MatchRatings @relation("HomeRatings", fields: [homeRatingsID], references: [id])
  homeRatingsID Int          @unique @map("home_ratings_id")
  awayRatings   MatchRatings @relation("AwayRatings", fields: [awayRatingsID], references: [id])
  awayRatingsID Int          @unique @map("away_ratings_id")

  @@map("match_results")
}

model MatchRatings {
  id          Int   @id @default(autoincrement())
  attack      Float
  midfield    Float
  defense     Float
  goalkeeping Float

  homeMatch MatchResult? @relation("HomeRatings")
  awayMatch MatchResult? @relation("AwayRatings")

  @@map("match_ratings")
}

model MatchEvent {
  id     String         @id @default(uuid())
  minute Int
  type   MatchEventType
  team   MatchTeam

  players Player[]

  matchResult   MatchResult @relation(fields: [matchResultID], references: [id])
  matchResultID Int         @map("match_result_id")

  @@map("match_events")
}

enum MatchTeam {
  HOME
  AWAY
}

enum MatchEventType {
  GOAL
  CARD
  SUBSTITUTION
  INJURY
}

model PlayerOnLineup {
  id         Int       @id() @default(autoincrement())
  position   Position
  lineupTeam MatchTeam

  player   Player @relation(fields: [playerID], references: [id])
  playerID String @map("player_id")
  match    Match  @relation(fields: [matchID], references: [id])
  matchID  String @map("match_id")

  @@map("players_on_lineups")
}

enum Position {
  ATTACKER
  MIDFIELDER
  DEFENDER
  GOALKEEPER
}

model League {
  id   String @id @default(uuid())
  name String @unique

  parentLeagueID  String?  @map("parent_league_id")
  parentLeague    League?  @relation("TeacherStudents", fields: [parentLeagueID], references: [id])
  childrenLeagues League[] @relation("TeacherStudents")

  seasons Season[]

  @@map("leagues")
}

model Season {
  id     String @id @default(uuid())
  number Int

  currentTeams Team[] @relation("CurrentSeason")
  pastTeams    Team[] @relation("PastSeasons")

  fixture Match[]

  league   League @relation(fields: [leagueID], references: [id])
  leagueID String @map("league_id")

  @@map("seasons")
}
